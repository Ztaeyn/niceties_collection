# Group of all
# binary_sensor.all_door_contacts
# binary_sensor.security - Binary Sensor Group of relevant sensors for windows and doors, all when gone, specific when home.


The following List and Total will exclude the above groups.
# List open doors
{% set doors = states.binary_sensor
  | select('match', '.*door.contact')
  | rejectattr('entity_id', 'in', ['binary_sensor.security_check_away','binary_sensor.security_check_home','binary_sensor.security_doors_and_windows','binary_sensor.all_door_contacts'])
  | selectattr('state', 'eq', 'on')
  | map(attribute='name') | list %}
{% set qty = doors | count %}
{% if qty == 0 %}
  Ingen
{% else %}
  {{doors | join(', ')}}
{% endif %}

# Count open doors
{% set doors = states.binary_sensor
  | select('match', '.*door.contact')
  | rejectattr('entity_id', 'in', ['binary_sensor.security_check_away','binary_sensor.security_check_home','binary_sensor.security_doors_and_windows','binary_sensor.all_door_contacts'])
  | selectattr('state', 'eq', 'on')
  | map(attribute='name') | list %}
{% set qty = doors | count %}
{% if qty == 0 %}
  0
{% else %}
  {{qty}}
{% endif %}

# List open windows
{% set windows = states.binary_sensor
  | select('match', '.*window.contact')
  | rejectattr('entity_id', 'in', ['binary_sensor.security_check_away','binary_sensor.security_check_home','binary_sensor.security_doors_and_windows','binary_sensor.all_window_contacts'])
  | selectattr('state', 'eq', 'on')
 | map(attribute='name') | list %}
{% set qty = windows | count %}
{% if qty == 0 %}
  Ingen
{% else %}
  {{windows | join(', ')}}
{% endif %}

# Count open windows
{% set number_open = (expand('group.all_window_contacts') | selectattr('state', 'eq', 'on') | list | count) %}
        {% if number_open > 0 %}
          {{number_open}}
        {% else %}
          0
        {% endif %}
